function outputUpdate(e){document.querySelector("#MasterVolumeOutput").value=100*e+"%"}function changeMasterVolume(e){STATE.volume=e}function changeLPcutoff(e){STATE.LPcutoff=e}function changeHPcutoff(e){STATE.HPcutoff=e}function createSvg(e,t,n){return d3.select(e).append("svg").attr("height",t).attr("width",n)}function renderChart(){requestAnimationFrame(renderChart),analyser.getByteFrequencyData(frequencyData),svg.selectAll("rect").data(frequencyData).attr("y",function(e){return svgHeight-e}).attr("height",function(e){return e}).attr("fill",function(e){return"rgb(0,0,"+e+" )"})}window.AudioContext=window.AudioContext||window.webkitAudioContext;var context=new AudioContext,settings={id:"keyboard",width:630,height:150,startNote:"A2",whiteNotesColour:"#fff",blackNotesColour:"#000",borderColour:"#000",activeColour:"orange",octaves:3},keyboard=new QwertyHancock(settings);masterGain=context.createGain(),nodes=[];var filter=context.createBiquadFilter();filter.type="lowpass";var filter2=context.createBiquadFilter();filter2.type="highpass";var STATE={volume:.5,LPcutoff:1e4,HPcutoff:0};filter.frequency.value=STATE.LPcutoff,filter2.frequency.value=STATE.HPcutoff,masterGain.gain.value=STATE.volume;var MasterVolume=document.getElementById("volume");MasterVolume.addEventListener("change",function(){changeMasterVolume(this.value),masterGain.gain.value=this.value});var analyser=context.createAnalyser(),LPcutoff=document.getElementById("LPcutoff");LPcutoff.addEventListener("change",function(){changeLPcutoff(this.value),filter.frequency.value=this.value});var LPcutoff=document.getElementById("HPcutoff");LPcutoff.addEventListener("change",function(){changeHPcutoff(this.value),filter2.frequency.value=this.value});var frequencyData=new Uint8Array(200),svgHeight=300,svgWidth=600,barPadding=1,svg=createSvg("#canvas",svgHeight,svgWidth);svg.selectAll("rect").data(frequencyData).enter().append("rect").attr("x",function(e,t){return t*(svgWidth/frequencyData.length)}).attr("width",svgWidth/frequencyData.length-barPadding);var oscillators={};keyboard.keyDown=function(e,t){var n=context.createOscillator();n.type="sawtooth",n.frequency.value=t,n.detune.value=-10,n.start(context.currentTime);var a=context.createOscillator();a.type="sawtooth",a.frequency.value=t,a.detune.value=10,a.start(context.currentTime),oscillators[t]=[n,a],n.connect(filter),a.connect(filter),filter.connect(filter2),filter2.connect(analyser),analyser.connect(masterGain),masterGain.connect(context.destination),renderChart()},keyboard.keyUp=function(e,t){oscillators[t].forEach(function(e){e.stop(context.currentTime)})};
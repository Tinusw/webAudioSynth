function outputUpdate(e){document.querySelector("#MasterVolumeOutput").value=100*e+"%"}function changeMasterVolume(e){STATE.volume=e}function changeLPcutoff(e){STATE.LPcutoff=e}function changeHPcutoff(e){STATE.HPcutoff=e}function frameLooper(){window.webkitRequestAnimationFrame(frameLooper);var e=document.getElementById("canvas");ctx=e.getContext("2d"),fbc_array=new Uint8Array(analyser.frequencyBinCount),analyser.getByteFrequencyData(fbc_array),ctx.beginPath(),ctx.clearRect(0,0,e.width,e.height),ctx.fillStyle="#000",bars=250;for(var t=0;t<bars;t++)bar_x=4*t,bar_width=2,bar_height=-(fbc_array[t]/2),ctx.fillRect(bar_x,e.height,bar_width,bar_height);ctx.closePath()}$(document).ready(function(){function e(e,t,a){return d3.select(e).append("svg").attr("height",t).attr("width",a)}var t=100,a=600,n=1,o=e("#canvas",t,a)}),window.AudioContext=window.AudioContext||window.webkitAudioContext;var context=new AudioContext,settings={id:"keyboard",width:630,height:150,startNote:"A2",whiteNotesColour:"#fff",blackNotesColour:"#000",borderColour:"#000",activeColour:"orange",octaves:3},keyboard=new QwertyHancock(settings);masterGain=context.createGain(),nodes=[];var filter=context.createBiquadFilter();filter.type="lowpass";var filter2=context.createBiquadFilter();filter2.type="highpass";var STATE={volume:.5,LPcutoff:1e4,HPcutoff:0};filter.frequency.value=STATE.LPcutoff,filter2.frequency.value=STATE.HPcutoff,masterGain.gain.value=STATE.volume;var MasterVolume=document.getElementById("volume");MasterVolume.addEventListener("change",function(){changeMasterVolume(this.value),masterGain.gain.value=this.value});var analyser=context.createAnalyser(),LPcutoff=document.getElementById("LPcutoff");LPcutoff.addEventListener("change",function(){changeLPcutoff(this.value),filter.frequency.value=this.value});var LPcutoff=document.getElementById("HPcutoff");LPcutoff.addEventListener("change",function(){changeHPcutoff(this.value),filter2.frequency.value=this.value});var oscillators={};keyboard.keyDown=function(e,t){var a=context.createOscillator();a.type="sawtooth",a.frequency.value=t,a.detune.value=-10,a.start(context.currentTime);var n=context.createOscillator();n.type="sawtooth",n.frequency.value=t,n.detune.value=10,n.start(context.currentTime),oscillators[t]=[a,n],a.connect(filter),n.connect(filter),filter.connect(filter2),filter2.connect(analyser),analyser.connect(masterGain),masterGain.connect(context.destination),frameLooper()},keyboard.keyUp=function(e,t){oscillators[t].forEach(function(e){e.stop(context.currentTime)})};